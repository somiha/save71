<html lang="en">

  <head>
    <link rel="icon" sizes="325x325" href="https://saveneed.com/images/save71_icon.webp">
    <meta property="og:title" content="Save71 Connects You and the World through Business.">
    <meta property="og:site_name" content="Save-71">
    <meta property="og:url" content="https://saveneed.com/login">
    <meta property="og:description" content="Unlock Global Connectivity with Save71 for Business.">
    <meta property="og:type" content="business.business">
    <meta property="og:image" content="https://saveneed.com/images/logo-og.webp">

    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- jQuery (includes Ajax library) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" />

    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css" />

    <!-- Custom Stylesheet -->
    <link rel="stylesheet" href="./css/style.css" />
    <link rel="stylesheet" href="/css/responsive.css" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/css/intlTelInput.css">

    <title>Save Need</title>
  </head>
  <% console.log({ogImage, ogTitle, ogUrl}) %>

  <body>
    <style>
      #loading-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        /* background-color: rgba(75, 74, 74, 0.289); */
        background-color: rgba(255, 255, 255, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }

      #loading-gif {
        width: 100px;
        height: 100px;
      }

      .login-container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        /* background-color: #f0f2f5; */
      }

      .iti {
        width: 100%;
        display: block;
      }


      .content {
        display: flex;
        justify-content: center;
        align-items: center;
        max-width: 1200px;
        width: 100%;
        background-color: white;
        /* box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        border-radius: 8px; */
        padding: 50px;
      }

      .left-side {
        width: 50%;
        padding-right: 40px;
        text-align: left;
      }

      .left-side img {
        width: 100%;
        max-width: 300px;
        margin-bottom: 20px;
      }

      .left-side h1 {
        font-size: 36px;
        color: #333;
      }

      .left-side p {
        font-size: 18px;
        color: #666;
      }

      .right-side {
        width: 50%;
      }

      @media (max-width: 768px) {
        .content {
          flex-direction: column;
          padding: 20px;
        }

        .left-side,
        .right-side {
          width: 100%;
        }

        .left-side {
          text-align: center;
          padding-right: 0;
        }
      }
    </style>
    <script src="/js/location.js"></script>

    <div class="login-container">


      <div class="content">
        <div id="loading-container" style="display: none">
          <img id="loading-gif" src="https://saveneed.com/images/loading.gif" alt="Loading..." />
        </div>
        <div class="left-side">
          <img src="https://saveneed.com/images/saveneed1.png" class=" mb-3" style="width: 70%;" />

          <p class="p-1">Where entrepreneurs and consumers thrive together.</p>
        </div>
        <div class="right-side">
          <!-- <div class="d-flex justify-content-center align-items-center border min-vh-100 login-page-div"
          style="width: 100vw"> -->
          <div class="d-flex flex-column row-gap-0">
            <!-- <img src="https://saveneed.com/images/saveneed1.png" class="p-2 mb-3"
              style="width: 70%; align-self: center;" /> -->

            <form class="d-flex flex-column row-gap-4" action="/login" method="POST">
              <div class="position-relative">
                <div class="">
                  <h5 class="text-center" style="color: red">
                    <b><i><%= loginMessage %></i></b>
                  </h5>
                  <label for="inputEmail1" class="form-label fw-bold">Mobile Number</label>
                </div>
                <input type="tel" class="form-control py-3" id="phone" aria-describedby="phonelHelp"
                  placeholder="Enter Your Phone Number" name="phone" style="
								box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.08),
									-2px -2px 4px rgba(0, 0, 0, 0.08);
							" />
                <div id="error-msg" style="color: red; margin-top: 5px;"></div>
                <div id="valid-msg" style="color: green; margin-top: 5px;"></div>
              </div>
              <div class="position-relative ">
                <label for="inputPassword" class="form-label fw-bold">Password</label>
                <div class="position-relative">

                  <input type="password" class="form-control py-3 inputPassword" id="inputPassword"
                    placeholder="Password" name="password" style="
								box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.08),
                -2px -2px 4px rgba(0, 0, 0, 0.08);
                " />
                  <p class="password-show-btn"
                    style="position:absolute; right:2%; top:50%; transform: translateY(-50%); cursor:pointer"><i
                      class="bi bi-eye-fill"></i></p>


                </div>
              </div>
              <!-- Trigger button for the modal -->


              <button type="submit" id="loginForm" class="btn btn-primary text-white py-3"
                style="background-color: #1a63a6" disabled>
                Login
              </button>
              <a href="#" id="forgotPasswordButton" class="text-center login-a" data-toggle="modal"
                data-target="#forgotPasswordModal" style="color: #1a63a6;">Forgot Password?</a>
              <hr />
              <p class="align-self-center"> <a href="/registration" class="btn btn-success p-5 py-3">Create new
                  account</a>
              </p>
            </form>
            <!-- The modal -->
            <div id="forgotPasswordModal" class="modal fade" tabindex="-1" role="dialog">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">Forgot Password</h5>
                    <button type="button" class="close btn" data-dismiss="modal">
                      &times;
                    </button>
                  </div>
                  <div class="modal-body my-2">
                    <div id="step1" class="step">
                      <label for="email">Enter the email you use for saveneed:</label>
                      <input type="email" id="email" name="email" class="form-control" placeholder="Enter Your Mail"
                        required />
                    </div>

                    <!-- Step 2 : Otp -->
                    <div id="step2" class="step" style="display: none">

                      <label for="otp">Enter OTP:</label>
                      <input type="text" id="otp" name="otp" class="form-control" required />
                      <input type="text" id="encUserId" name="encUserId" class="form-control" value="" required
                        hidden />
                      <input type="text" id="userId" name="userId" class="form-control" value="" required hidden />
                      <button id="verifyOTPButton" class="btn btn-primary mt-2">Verify OTP</button>
                      <button id="resendOTPButton" class="btn btn-primary mt-2">Resend OTP</button>
                      <p id="otpMessage" style="display: none;">An OTP is sent to your email</p>
                      <p id="successMessage" style="display: none;">HIII</p>
                    </div>

                    <!-- Step 3 : Reset Pass -->
                    <div id="step3" class="step" style="display: none">
                      <label for="newPassword">New Password:</label>
                      <div class="input-group mb-3 position-relative">
                        <input type="password" id="newPassword" name="newPassword" class="form-control" required />
                        <!-- <button class="btn btn-outline-secondary" type="button" id="toggleNewPassword">
                    <i class="bi bi-eye"></i>
                  </button> -->
                        <p class="password-show-btn"
                          style="position:absolute; right:2%; top:50%; transform: translateY(-50%); cursor:pointer"><i
                            class="bi bi-eye-fill"></i></p>

                      </div>
                      <label for="confirmPassword">Confirm Password:</label>
                      <div class="input-group mb-3 position-relative">
                        <input type="password" id="confirmPassword" name="confirmPassword" class="form-control"
                          required />
                        <!-- <button class="btn btn-outline-secondary" type="button" id="toggleConfirmPassword">
                    <i class="bi bi-eye"></i>
                  </button> -->

                        <p class="password-show-btn"
                          style="position:absolute; right:2%; top:50%; transform: translateY(-50%); cursor:pointer"><i
                            class="bi bi-eye-fill"></i></p>
                      </div>
                      <p id="passwordMismatchError" class="text-danger" style="display: none">
                        Passwords do not match.
                      </p>
                      <button id="resetPasswordButton" class="btn btn-primary">Reset Password</button>
                    </div>

                    <p id="resetStatus" class="text-success" style="display: none"></p>
                  </div>
                  <div class="modal-footer">
                    <button id="submitButton" class="btn btn-primary">
                      Submit
                    </button>
                    <button id="resetPasswordButton" class="btn btn-primary" style="display: none" type="button">
                      Reset Password
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- </div> -->
        </div>
      </div>
    </div>
  </body>
  <script src="/js/index.js"></script>

</html>

<!-- <script>
  async function getUserLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(successCallback, errorCallback);
    } else {
      alert("Geolocation is not supported by this browser.");
    }
  }

  function successCallback(position) {
    const latitude = position.coords.latitude;
    const longitude = position.coords.longitude;
  }

  function errorCallback(error) {
    if (error.code === error.PERMISSION_DENIED) {
      // Instructions for enabling location based on browser
      const message =
        "Location Access Denied! \n\n" +
        "To use AREA SHOP, please enable location access in your browser settings:\n\n" +
        "For Chrome: Go to Settings > Privacy and security > Site settings > Location\n" +
        "For Firefox: Go to Settings > Privacy & Security > Permissions > Location\n" +
        "For Safari: Go to Preferences > Websites > Location\n\n" +
        "Would you like to retry accessing your location?";

      // Show the alert
      alert(message);


    } else {
      console.error('Error retrieving location:', error);
    }
  }

  // Call the function to get the location when the page loads
  window.onload = function () {
    getUserLocation();
  };
</script> -->


<script>
  $(document).ready(function () {
    // Open the modal when the button is clicked
    $('#forgotPasswordButton').click(function () {
      $('#forgotPasswordModal').modal('show');
    });

    // Close the modal when the close button or outside the modal is clicked
    $('.modal').on(
      'click',
      ".close, .modal-footer button[data-dismiss='modal']",
      function () {
        $('#forgotPasswordModal').modal('hide');
      }
    );

    // Switch to the next step when the email is submitted
    $('#submitButton').click(function () {
      var email = $('#email').val();
      var step1 = $('#step1');

      // Remove any existing error messages
      step1.find('.text-danger').remove();

      // Perform Ajax request to verify the email
      $.ajax({
        type: 'POST',
        url: '/emailVerify', // Replace with the actual endpoint for email verification
        data: {
          email: email,
        },
        success: function (response) {
          if (response.status === 'success') {
            $('#step1').hide();
            $('#step2').show();
            $('#submitButton').hide();
            $('#resetPasswordButton').show();
            $('#encUserId').val(response.encUserId);
            $('#userId').val(response.userId);

            $.ajax({
              type: 'POST',
              url: '/emailVerificationRequestAPI',
              data: {
                encUserId: response.encUserId,
                userId: response.userId
              },
              success: (response) => {
                if (response.status === true || response.status === 'success') {
                  $('#step2').show();
                  $('#submitButton').hide();
                  $('#resetPasswordButton').show();
                } else {
                  var error = $('<p class="mt-2">')
                    .text(`${response.message}`)
                    .addClass('text-danger');
                  $('#step2').append(error);
                }
              },
              error: () => {
                var error = $('<p>')
                  .text('Email verification failed')
                  .addClass('text-danger');
                step1.append(error);
              },
            });
          } else {
            // Display an error message if the email is not valid
            var error = $('<p>').text('Invalid email').addClass('text-danger');
            step1.append(error);
          }
        },
        error: function () {
          var error = $('<p>')
            .text('email verification failed')
            .addClass('text-danger');
          step1.append(error);
        },
      });
    });


    // OTP verify
    $('#verifyOTPButton').click(function () {
      var enteredOTP = $('#otp').val();
      var encUserId = $('#encUserId').val();
      var userId = $('#userId').val();
      var step2 = $('#step2');

      // Remove any existing error messages
      step2.find('.text-danger').remove();

      // Perform Ajax request to verify the OTP
      $.ajax({
        type: 'POST',
        url: '/emailVerificationPostAPI',
        data: {
          otp: enteredOTP,
          encUserId,
          userId
        },
        success: function (response) {

          if (response.status === 'success') {
            const successMessage = response.data.phone + ' is verified';
            const successMessageId = $('#successMessage').show().text(successMessage);
            // OTP verification successful
            // sleep for 5 seconds
            setTimeout(function () {
              $('#step2').hide();
              $('#step3').show();
              $('#verifyOTPButton').hide();
              $('#resetPasswordButton').show();
            }, 5000);

          } else {
            var error = $('<p>').text('Invalid OTP').addClass('text-danger');
            step2.append(error);
          }
        },
        error: function () {
          var error = $('<p>')
            .text('OTP verification failed')
            .addClass('text-danger');
          step2.append(error);
        },
      });
    });


    $('#resetPasswordButton').click(function () {
      var newPassword = $('#newPassword').val();
      var confirmPassword = $('#confirmPassword').val();
      var modalBody = $('#forgotPasswordModal .modal-body');
      var email = $('#email').val();

      // Remove any existing error messages
      modalBody.find('.text-danger').remove();

      // Check if passwords match
      if (newPassword !== confirmPassword) {
        var error = $('<p>')
          .text('Passwords do not match.')
          .addClass('text-danger');
        $('#step3').append(error);
        $('#passwordMismatchError').show();
        return; // Stop processing if passwords don't match
      }

      // Perform Ajax request to reset the password
      $.ajax({
        type: 'POST',
        url: '/passReset/' + email, // Replace with the actual endpoint for password reset
        data: {
          newPassword: newPassword,
        },
        success: function (response) {
          if (response === 'success') {
            // Password reset successful
            $('#resetStatus')
              .text('Password reset successful')
              .addClass('text-success')
              .show();
            $('#newPassword').val('');
            $('#confirmPassword').val('');
            setTimeout(function () {
              window.location.href = '/login'; // Replace '/login' with your actual login page URL
            }, 300);
          } else {
            // Handle other error cases
            var error = $('<p>')
              .text('Password reset failed')
              .addClass('text-danger');
            modalBody.append(error);
          }
        },
        error: function () {
          // Handle error case
          var error = $('<p>')
            .text('Password reset failed')
            .addClass('text-danger');
          modalBody.append(error);
        },
      });
    });

    $('#resendOTPButton').click(function () {
      var encUserId = $('#encUserId').val();
      var userId = $('#userId').val();

      // Perform Ajax request to resend the OTP
      $.ajax({
        type: 'GET',
        url: '/resendOtpByUserId/' + userId, // Replace with the actual endpoint for OTP resend
        success: function (response, status, xhr) {
          // Handle success case

          if (response.status === "success") {
            // OTP resend successful

          } else {
            // Handle other error cases
            var error = $('<p>')
              .text('OTP resend failed')
              .addClass('text-danger');
            $('#step3').append(error);
          }
        },
        error: function (xhr, status, error) {
          // Log additional information for debugging
          console.log('Error:', error);
          console.log('Status:', status);
          console.log('XHR:', xhr);

          // Handle Ajax request error
          var errorMessage = 'An error occurred while resending the OTP.';
          if (xhr.status === 302) {
            errorMessage = 'Redirected to: ' + xhr.getResponseHeader('Location');
          }
          var errorElement = $('<p>')
            .text(errorMessage)
            .addClass('text-danger');
          $('#step3').append(errorElement);
        }
      });
    });


    // Toggle visibility of the new password
    // $('#toggleNewPassword').click(function() {
    //   var newPasswordInput = $('#newPassword');
    //   var newPasswordType = newPasswordInput.attr('type');
    //   newPasswordInput.attr('type', newPasswordType === 'password' ? 'text' : 'password');
    // });

    // // Toggle visibility of the confirm password
    // $('#toggleConfirmPassword').click(function() {
    //   var confirmPasswordInput = $('#confirmPassword');
    //   var confirmPasswordType = confirmPasswordInput.attr('type');
    //   confirmPasswordInput.attr('type', confirmPasswordType === 'password' ? 'text' : 'password');
    // });

  });
</script>






<script src="https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/js/intlTelInput.min.js"></script>

<script>
  window.intlTelInputGlobals.loadUtils("./js/utils.js"); // for isValidNumber function

  function getDecCCo(url) {
    return fetch(url)
      .then(response => response.json())
      .then(data => {
        return {
          countryCode: data.countryCode
        };
      })
      .catch(error => {
        console.error('Error:', error);
        throw error;
      });
  }

  async function initializeTelInput() {
    try {
      const apiUrl = `/__gCCo`;
      const {
        countryCode
      } = await getDecCCo(apiUrl);
      const input = document.querySelector("#phone");

      const telInput = intlTelInput(input, {
        initialCountry: countryCode || "auto",
        autoInsertDialCode: true,
        separateDialCode: false,
      });


      const errorDisplay = document.querySelector("#error-msg");
      const validDisplay = document.querySelector("#valid-msg");
      const submitButt = document.querySelector("#loginForm");

      // Function to update the placeholder based on the selected country
      function updatePlaceholder() {
        const selectedCountryData = telInput.getSelectedCountryData();
        const newInputValue = "+" + selectedCountryData.dialCode;
        input.value = newInputValue;
      }

      // Function to check if the entered phone number is valid
      function checkValidNumber() {
        if (input.value.trim()) {
          if (telInput.isValidNumber()) {
            validDisplay.textContent = "Valid phone number";
            errorDisplay.textContent = "";
            submitButt.disabled = false;
          } else {
            validDisplay.textContent = "";
            errorDisplay.textContent = "Invalid phone number";
            submitButt.disabled = true;
          }
        }
      }

      updatePlaceholder();
      input.addEventListener("countrychange", updatePlaceholder);
      input.addEventListener("keyup", checkValidNumber); // Check validity on keyup event
    } catch (error) {
      console.error('Error:', error);
    }
  }

  initializeTelInput();
</script>


<script>
  const passShowBtn = document.querySelectorAll('.password-show-btn');
  passShowBtn.forEach(psb => {
    psb.addEventListener('click', e => {
      const passField = psb.parentElement.children[0];
      if (passField.type == 'password') passField.type = 'text';
      else passField.type = 'password'
    })
  })
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function () {
    $('#resendOTPButton').click(function () {
      $('#otpMessage').fadeIn(); // Show the message
      setTimeout(function () {
        $('#otpMessage').fadeOut(); // Hide the message after a certain time (optional)
      }, 3000); // Hide after 3 seconds (3000 milliseconds)
    });
  });
</script>